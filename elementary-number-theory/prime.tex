\chapter{Primes}
\begin{python0}
from solutions import *; clear()
\end{python0}
% Primes and Number Theory

\textbf{Definition of Prime}
A prime $p$ is a positive integer $> 1$ that is divisible only by 1 and itself.
Examples: 2, 3, 5, 7, 11, 13, 17, 19, ...

\textbf{Classification of Integers}
\begin{itemize}
\item 0 - zero element
\item 1 - unit element (only invertible element $\geq 0$)
\item primes - 2, 3, 5, 7, 11, ...
\item composites - integers $> 1$ which are not primes
\end{itemize}

\textbf{Euclid's Lemma}
If $p$ is prime and $p \mid ab$, then either $p \mid a$ or $p \mid b$.

\textbf{Proof}:
Assume $p \nmid a$ (otherwise done). 
Since $\gcd(a,p) \mid p$ and $p$ is prime, $\gcd(a,p) = 1$.
By BÃ©zout's identity, $\exists x,y \in \mathbb{Z}$ such that $ax + py = 1$.
Multiply by $b$: $abx + pby = b$
Since $p \mid ab$ and $p \mid pb$, we have $p \mid b$.

\textbf{Corollary}
If $p$ is prime and $p \mid a_1a_2 \cdots a_n$, then $p \mid a_i$ for at least one $i$.

\textbf{Proof}:
By strong induction. Base case $n=2$ is Euclid's lemma.
Inductive step: If $p \mid a_1a_2 \cdots a_na_{n+1}$, let $b = a_na_{n+1}$.
Then $p \mid a_1a_2 \cdots a_{n-1}b$.
By induction, $p$ divides at least one of $a_1,...,a_{n-1},b$.
If $p \mid b = a_na_{n+1}$, then by Euclid's lemma, $p \mid a_n$ or $p \mid a_{n+1}$.
Therefore $p \mid a_i$ for at least one $i \in \{1,2,...,n+1\}$.

\textbf{Fundamental Theorem of Arithmetic}
Every positive integer $> 1$ can be written as a unique product of primes (up to permutation).

\textbf{Proof}:
(a) Existence: By induction on $n \geq 2$.
Base: $n=2$ is prime, so it's a product of itself.
Inductive step: For $n+1$, either:
- $n+1$ is prime (done)
- $n+1$ is composite: $n+1 = dm$ where $1 < d,m < n+1$
  By induction, $d = p_1 \cdots p_k$ and $m = q_1 \cdots q_l$
  So $n+1 = p_1 \cdots p_k q_1 \cdots q_l$

(b) Uniqueness: If $p_1 \cdots p_m = q_1 \cdots q_n$ where primes are in ascending order:
- $p_1 \mid q_1 \cdots q_n$, so by Euclid's lemma, $p_1 \mid q_i$ for some $i$
- Since $q_i$ is prime, $p_1 = q_i$
- Since primes are arranged in ascending order, $p_1 = q_1$
- Cancelling: $p_2 \cdots p_m = q_2 \cdots q_n$
- Continue this process to get $m = n$ and $p_i = q_i$ for all $i$

\textbf{Properties of Prime Factorization}
Let $a = \prod_{p \in P} p^{a_p}$, $b = \prod_{p \in P} p^{b_p}$, $c = \prod_{p \in P} p^{c_p}$ where $P$ is a finite set of primes.
\begin{itemize}
\item (a) $c = ab \implies c_p = a_p + b_p$
\item (b) $a \mid b \implies a_p \leq b_p$ for all $p \in P$
\item (c) $c = \gcd(a, b) \implies c_p = \min(a_p, b_p)$
\item (d) $c = \text{lcm}(a, b) \implies c_p = \max(a_p, b_p)$
\item (e) $\gcd(a, b) \cdot \text{lcm}(a, b) = ab$
\end{itemize}

\textbf{Bound on Prime Factors}
If $n > 1$ is not prime, then there is a prime factor $p$ such that $p \leq \sqrt{n}$.

\textbf{Brute-Force Primality Test}
\begin{verbatim}
def is_prime(n):
    if n < 2:
        return False
    d = 2
    while d*d <= n:  # d <= sqrt(n)
        if n % d == 0:
            return False
        d += 1
    return True
\end{verbatim}

Runtime: $O(\sqrt{n})$ with respect to value, $O(2^{b/2})$ for $b$ bits (exponential).

\textbf{Exercise Solutions}

\textbf{Exercise 2.7.1}: Prove there are infinitely many composites.

\textbf{Proof}:
For any $n \geq 4$, consider $n!$ (factorial). 
$n! = n \cdot (n-1) \cdot ... \cdot 2 \cdot 1$
$n! \geq n \geq 4$, so $n! > 1$.
Also, for any $k$ where $2 \leq k \leq n$, we have $k \mid n!$. 
So $n!$ has multiple divisors and is therefore composite.
Since we can construct a unique composite $n!$ for every $n \geq 4$, 
there are infinitely many composites.

\textbf{Exercise 2.7.2}: Prove there are infinitely many primes of form $4k+3$.

\textbf{Proof}:
Assume there are finitely many primes of the form $4k+3$: $p_1, p_2, \ldots, p_r$.
Let $N = 4p_1p_2\cdots p_r - 1 = 4M - 1$ where $M = p_1p_2\cdots p_r$.
Note that $N \equiv 3 \pmod{4}$.

Now, $N$ must have a prime factor. Let $q$ be any prime factor of $N$.

If $q \equiv 1 \pmod{4}$, then $q \mid N$ implies $q \mid 4M-1$.
Since $q \equiv 1 \pmod{4}$, we have $q = 4t+1$ for some $t$.
But then $q \mid 4M-1$ implies $(4t+1) \mid (4M-1)$, which means $(4t+1) \mid (4M-(4t+1))$, so $(4t+1) \mid (4(M-t)-2)$.
This means $(4t+1) \mid 2$, which is impossible since $q = 4t+1 \geq 5$.

Therefore, any prime factor $q$ of $N$ must be of the form $4k+3$.
But this means $q$ is one of $p_1, p_2, \ldots, p_r$.
So $q \mid p_1p_2\cdots p_r$, which means $q \mid M$.

Now we have:
- $q \mid N = 4M - 1$
- $q \mid 4M$
This implies $q \mid (4M - 1) - 4M = -1$, which is impossible for a prime.

Therefore, our assumption was wrong: there are infinitely many primes of the form $4k+3$.

\textbf{Exercise 2.7.10}: Count Primes (LeetCode 204)

Sieve of Eratosthenes algorithm:
\begin{verbatim}
def countPrimes(n):
    if n <= 2:
        return 0
    
    # Initialize array with all numbers potentially prime
    isPrime = [True] * n
    isPrime[0] = isPrime[1] = False
    
    # Sieve algorithm
    for i in range(2, int(n**0.5) + 1):
        if isPrime[i]:
            # Mark all multiples as non-prime
            for j in range(i*i, n, i):
                isPrime[j] = False
    
    # Count primes
    return sum(isPrime)
\end{verbatim}

Time complexity: $O(n \log \log n)$
Space complexity: $O(n)$

\textbf{Exercise 2.7.11}: Perfect Number (LeetCode 507)

\begin{verbatim}
def checkPerfectNumber(num):
    if num <= 1:
        return False
    
    # Sum of divisors starts with 1
    sum_divisors = 1
    
    # Check divisors up to sqrt(num)
    for i in range(2, int(num**0.5) + 1):
        if num % i == 0:
            # Add both i and num/i to sum
            sum_divisors += i
            if i != num // i:  # Avoid counting sqrt(num) twice
                sum_divisors += num // i
    
    return sum_divisors == num
\end{verbatim}

Perfect numbers (for verification): 6, 28, 496, 8128, ...

\textbf{Exercise 2.7.18}: Greatest Common Divisor of Strings (LeetCode 1071)

\begin{verbatim}
def gcdOfStrings(str1, str2):
    # If concatenation in both orders is not the same, no GCD exists
    if str1 + str2 != str2 + str1:
        return ""
    
    # GCD length is the GCD of the lengths
    def gcd(a, b):
        while b:
            a, b = b, a % b
        return a
    
    gcd_len = gcd(len(str1), len(str2))
    return str1[:gcd_len]
\end{verbatim}

Time complexity: $O(n)$ where $n$ is the length of the longer string
Space complexity: $O(n)$ for string operations

\textbf{Exercise 2.7.19}: Euler's Prime-Generating Polynomial

$P(x) = x^2 - x + 41$ generates primes for $x = 0, 1, 2, ..., 40$.

Verification for a few values:
- $P(0) = 0^2 - 0 + 41 = 41$ (prime)
- $P(1) = 1^2 - 1 + 41 = 41$ (prime)
- $P(2) = 2^2 - 2 + 41 = 43$ (prime)
- $P(3) = 3^2 - 3 + 41 = 47$ (prime)

$P(40) = 40^2 - 40 + 41 = 1600 - 40 + 41 = 1601$ (prime)
$P(41) = 41^2 - 41 + 41 = 1681 = 41^2$ (composite)

Euler lucky numbers are values of $n$ where $x^2 - x + n$ produces primes for all $0 \leq x < n$.
Examples include 2, 3, 5, 11, 17, and 41.

\textbf{Exercise 2.7.20}: Polynomials Can't Always Generate Primes

\textbf{Proof}:
Let $P(x)$ be a non-constant polynomial.

For any prime $p$, let's consider values of $P(x)$ modulo $p$.
Since there are only $p$ possible remainders when dividing by $p$ (namely $0, 1, 2, ..., p-1$),
by the Pigeonhole Principle, the sequence $P(0), P(1), P(2), ...$ must have values that repeat modulo $p$.

This means there exist distinct integers $a$ and $b$ such that $P(a) \equiv P(b) \pmod{p}$.
Let $m = |b-a|$. Then $p \mid (P(a) - P(b))$.

Now, for any integer $k$, consider $P(a + km)$.
By properties of polynomials, $P(a + km) \equiv P(a) \pmod{p}$ for all $k$.

Therefore, $p \mid P(a + kp)$ for all $k \geq 0$.
But if $p \mid P(n)$, then $P(n)$ cannot be prime unless $P(n) = p$.

Since $P$ is non-constant, there can be at most one value of $n$ where $P(n) = p$.
Therefore, there are infinitely many values $n$ where $P(n)$ is composite.
